<div align="center">

# 🚀 Microservicio de Gestión de Usuarios

<div style="background: #f8f9fa; padding: 20px; border-radius: 15px; margin: 20px 0; box-shadow: 0 4px 12px rgba(0,0,0,0.1); border: 2px solid #e9ecef;">
  <h2 style="color: #212529; margin: 0; font-size: 1.5em;">Sistema Completo de Gestión de Usuarios con Arquitectura Hexagonal</h2>
  <p style="color: #6c757d; margin: 10px 0 0 0;">Registro • Verificación • Términos y Condiciones • Autenticación JWT</p>
</div>

<div style="display: flex; justify-content: center; gap: 20px; margin: 30px 0; flex-wrap: wrap;">
  <div style="background: #ffffff; padding: 15px; border-radius: 10px; border-left: 4px solid #28a745; min-width: 200px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
    <h3 style="margin: 0 0 10px 0; color: #28a745;">✅ Registro</h3>
    <p style="margin: 0; color: #6c757d;">Clientes y Administradores</p>
  </div>
  <div style="background: #ffffff; padding: 15px; border-radius: 10px; border-left: 4px solid #007bff; min-width: 200px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
    <h3 style="margin: 0 0 10px 0; color: #007bff;">🔐 Verificación</h3>
    <p style="margin: 0; color: #6c757d;">Códigos por Email</p>
  </div>
  <div style="background: #ffffff; padding: 15px; border-radius: 10px; border-left: 4px solid #ffc107; min-width: 200px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
    <h3 style="margin: 0 0 10px 0; color: #ffc107;">📋 Términos</h3>
    <p style="margin: 0; color: #6c757d;">Aceptación Digital</p>
  </div>
  <div style="background: #ffffff; padding: 15px; border-radius: 10px; border-left: 4px solid #dc3545; min-width: 200px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
    <h3 style="margin: 0 0 10px 0; color: #dc3545;">🛡️ Seguridad</h3>
    <p style="margin: 0; color: #6c757d;">JWT + Rate Limiting</p>
  </div>
</div>

</div>

---

<div style="background: #ffffff; padding: 25px; border-radius: 15px; margin: 30px 0; border: 2px solid #e9ecef; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">

## 🛠️ Stack Tecnológico

<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 20px;">

### 🔧 Backend
<div style="background: #f8f9fa; padding: 20px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border: 1px solid #dee2e6;">
  <ul style="list-style: none; padding: 0; margin: 0;">
    <li style="padding: 8px 0; border-bottom: 1px solid #dee2e6; color: #212529;">☕ <strong>Java 17</strong> - Lenguaje principal</li>
    <li style="padding: 8px 0; border-bottom: 1px solid #dee2e6; color: #212529;">🌱 <strong>Spring Boot 3.2.3</strong> - Framework</li>
    <li style="padding: 8px 0; border-bottom: 1px solid #dee2e6; color: #212529;">🔒 <strong>Spring Security + JWT</strong> - Autenticación</li>
    <li style="padding: 8px 0; border-bottom: 1px solid #dee2e6; color: #212529;">🗄️ <strong>Spring Data JPA</strong> - Persistencia</li>
    <li style="padding: 8px 0; border-bottom: 1px solid #dee2e6; color: #212529;">🐬 <strong>MariaDB</strong> - Base de datos</li>
    <li style="padding: 8px 0; border-bottom: 1px solid #dee2e6; color: #212529;">🔄 <strong>MapStruct</strong> - Mapeo de objetos</li>
    <li style="padding: 8px 0; border-bottom: 1px solid #dee2e6; color: #212529;">⚡ <strong>Lombok</strong> - Reducción de código</li>
  </ul>
</div>

### 📊 Observabilidad
<div style="background: #f8f9fa; padding: 20px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border: 1px solid #dee2e6;">
  <ul style="list-style: none; padding: 0; margin: 0;">
    <li style="padding: 8px 0; border-bottom: 1px solid #dee2e6; color: #212529;">📈 <strong>Micrometer + Prometheus</strong> - Métricas</li>
    <li style="padding: 8px 0; border-bottom: 1px solid #dee2e6; color: #212529;">🔍 <strong>Zipkin</strong> - Distributed tracing</li>
    <li style="padding: 8px 0; border-bottom: 1px solid #dee2e6; color: #212529;">🏥 <strong>Spring Boot Actuator</strong> - Health checks</li>
    <li style="padding: 8px 0; border-bottom: 1px solid #dee2e6; color: #212529;">📝 <strong>Logback</strong> - Logging estructurado</li>
    <li style="padding: 8px 0; border-bottom: 1px solid #dee2e6; color: #212529;">🌐 <strong>Eureka</strong> - Service discovery</li>
  </ul>
</div>

### 🛡️ Seguridad y Rendimiento
<div style="background: #f8f9fa; padding: 20px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border: 1px solid #dee2e6;">
  <ul style="list-style: none; padding: 0; margin: 0;">
    <li style="padding: 8px 0; border-bottom: 1px solid #dee2e6; color: #212529;">🎫 <strong>JWT</strong> - Autenticación stateless</li>
    <li style="padding: 8px 0; border-bottom: 1px solid #dee2e6; color: #212529;">🔐 <strong>BCrypt</strong> - Encriptación</li>
    <li style="padding: 8px 0; border-bottom: 1px solid #dee2e6; color: #212529;">🚫 <strong>Rate Limiting</strong> - Protección</li>
    <li style="padding: 8px 0; border-bottom: 1px solid #dee2e6; color: #212529;">⚡ <strong>Caching</strong> - Mejora de rendimiento</li>
    <li style="padding: 8px 0; border-bottom: 1px solid #dee2e6; color: #212529;">✅ <strong>Validation</strong> - Validación de datos</li>
  </ul>
</div>

</div>

</div>

---

<div style="background: #ffffff; padding: 25px; border-radius: 15px; margin: 30px 0; border: 2px solid #e9ecef; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">

## 🏗️ Arquitectura del Proyecto

<div style="background: #f8f9fa; padding: 25px; border-radius: 10px; margin-top: 20px; border: 1px solid #dee2e6;">

### 📁 Estructura de Carpetas

```
users-service/
├── 📂 core/                          # Componentes centrales
│   ├── 🔧 config/                    # Configuraciones globales
│   ├── 🚫 rateLimiting/              # Sistema de rate limiting
│   ├── 📝 logging/                   # Sistema de logging
│   └── ⚠️ exception/                 # Manejo global de excepciones
│
├── 📂 registrationApi/               # API de Registro
│   ├── 🎯 application/               # Casos de uso
│   ├── 🏛️ domain/                    # Modelos y puertos
│   ├── 🔌 infrastructure/            # Adaptadores y persistencia
│   └── 🌐 web/                       # Controladores y DTOs
│
├── 📂 termsAndConditionsApi/         # API de Términos
│   ├── 🎯 application/               # Casos de uso
│   ├── 🏛️ domain/                    # Modelos y puertos
│   ├── 🔌 infrastructure/            # Adaptadores y persistencia
│   └── 🌐 web/                       # Controladores y DTOs
│
└── 📂 verificationCodeApi/           # API de Verificación
    ├── 🎯 application/               # Casos de uso
    ├── 🏛️ domain/                    # Modelos y puertos
    ├── 🔌 infrastructure/            # Adaptadores y persistencia
    └── 🌐 web/                       # Controladores y DTOs
```

</div>

</div>

---

<div style="background: #ffffff; padding: 25px; border-radius: 15px; margin: 30px 0; border: 2px solid #e9ecef; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">

## 🔐 Sistema de Autenticación y Seguridad

<div style="background: #f8f9fa; padding: 25px; border-radius: 10px; margin-top: 20px; border: 1px solid #dee2e6;">

### 🎫 JWT (JSON Web Tokens)
El servicio utiliza JWT para autenticación stateless. Para acceder a endpoints protegidos:

```http
Authorization: Bearer <tu_token_jwt>
```

### 🛡️ Características de Seguridad
- **BCrypt** para encriptación de contraseñas
- **Rate Limiting** para prevenir ataques de fuerza bruta
- **Validación de datos** con Bean Validation
- **CORS** configurado para desarrollo

</div>

</div>

---

<div style="background: #ffffff; padding: 25px; border-radius: 15px; margin: 30px 0; border: 2px solid #e9ecef; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">

## 📊 Observabilidad y Monitoreo

<div style="background: #f8f9fa; padding: 25px; border-radius: 10px; margin-top: 20px; border: 1px solid #dee2e6;">

<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">

### 📈 Métricas (Prometheus)
- **Endpoint**: `/actuator/prometheus`
- Métricas de HTTP requests, latencia, errores
- Métricas personalizadas de negocio

### 📝 Logging (Logback)
- Logs estructurados con rotación automática
- Diferentes niveles por paquete
- Integración con sistemas de log aggregation

### 🔍 Tracing (Zipkin)
- Distributed tracing para requests
- Trazabilidad completa de operaciones
- Análisis de latencia y dependencias

### 🏥 Health Checks
- **Endpoint**: `/actuator/health`
- Verificación de base de datos
- Verificación de servicios externos

</div>

</div>

</div>

---

<div style="background: #ffffff; padding: 25px; border-radius: 15px; margin: 30px 0; border: 2px solid #e9ecef; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">

## 📝 Endpoints de la API

<div style="background: #f8f9fa; padding: 25px; border-radius: 10px; margin-top: 20px; border: 1px solid #dee2e6;">

<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">

### 🔐 Autenticación

#### Login de Usuario
```http
POST /auth/login
```

**Request Body:**
```json
{
    "email": "juan.perez@email.com",
    "password": "Contraseña123!"
}
```

### 👤 Registro de Usuarios

#### Registro de Cliente
```http
POST /register/customer
```

**Request Body:**
```json
{
    "name": "Juan",
    "lastName": "Pérez",
    "email": "juan.perez@email.com",
    "password": "Contraseña123!",
    "phone": "+573001234567",
    "birthDate": "1990-01-01"
}
```

#### Registro de Administrador
```http
POST /register/admin
```

**Request Body:**
```json
{
    "name": "Admin",
    "lastName": "Sistema",
    "email": "admin@sistema.com",
    "password": "Admin123!",
    "phone": "+573001234567",
    "area": "Sistemas"
}
```

### 📧 Verificación de Códigos

#### Enviar Código de Verificación
```http
POST /verification/send
```

#### Verificar Código
```http
POST /verification/check
```

#### Verificar Estado de Email
```http
POST /verification/status
```

### 📋 Términos y Condiciones

#### Obtener Todos los Términos Activos
```http
GET /terms
```

#### Aceptar Término Individual
```http
POST /terms/accept
```

#### Aceptar Múltiples Términos
```http
POST /terms/accept/multiple
```

#### Verificar Aceptación de Término
```http
GET /terms/verify/{userId}/{termId}
```

</div>

</div>

</div>

---

<div style="background: #ffffff; padding: 25px; border-radius: 15px; margin: 30px 0; border: 2px solid #e9ecef; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">

## 🚫 Sistema de Rate Limiting

<div style="background: #f8f9fa; padding: 25px; border-radius: 10px; margin-top: 20px; border: 1px solid #dee2e6;">

### 🎯 Configuración por Endpoint

<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">

#### RegisterController
- **`registerCustomer`**: 10 solicitudes por minuto

#### TermController
- **`getAllActiveTerms`**: 20 solicitudes por minuto
- **`getActiveTermByType`**: 20 solicitudes por minuto
- **`getAllTerms`**: 20 solicitudes por minuto
- **`getTermById`**: 20 solicitudes por minuto
- **`acceptTerm`**: 3 solicitudes por minuto
- **`acceptMultipleTerms`**: 3 solicitudes por minuto
- **`verifyAcceptance`**: 5 solicitudes por minuto
- **`verifyAllTermsByEmail`**: 5 solicitudes por minuto

#### VerificationCodeController
- **`sendVerificationCode`**: 1 solicitud cada 5 minutos
- **`verifyCode`**: 1 solicitud cada 5 minutos
- **`checkEmailVerification`**: 5 solicitudes por minuto

</div>

### 🛡️ Características del Sistema
- **Identificación por JWT o IP**: Usa email del JWT si está autenticado, sino IP
- **Bloqueos progresivos**: Aumenta la duración del bloqueo con cada infracción
- **Configuración flexible**: Límites configurables por endpoint
- **Thread-safe**: Usa ConcurrentHashMap para operaciones concurrentes
- **Logging detallado**: Registra todas las operaciones para debugging

</div>

</div>

---

<div style="background: #ffffff; padding: 25px; border-radius: 15px; margin: 30px 0; border: 2px solid #e9ecef; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">

## ⚙️ Configuración Modular

<div style="background: #f8f9fa; padding: 25px; border-radius: 10px; margin-top: 20px; border: 1px solid #dee2e6;">

### 📁 Estructura de Archivos de Configuración

<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">

#### Archivos Base
- **`application.properties`** - Archivo principal
- **`application-common.properties`** - Configuración básica
- **`application-database.properties`** - MariaDB y JPA
- **`application-security.properties`** - JWT
- **`application-email.properties`** - SMTP y verificación
- **`application-logging.properties`** - Logs
- **`application-rate-limit.properties`** - Rate limiting

#### Archivos por Entorno
- **`application-dev.properties`** - Desarrollo
- **`application-prod.properties`** - Producción

</div>

### 🚀 Cómo Usar

#### Desarrollo Local
```bash
# Usar configuración por defecto
java -jar users-service.jar

# O especificar explícitamente
java -jar users-service.jar --spring.profiles.active=dev
```

#### Producción
```bash
# Usar configuración de producción
java -jar users-service.jar --spring.profiles.active=prod

# Con variables de entorno
DB_USERNAME=prod_user DB_PASSWORD=prod_pass JWT_SECRET=secret \
java -jar users-service.jar --spring.profiles.active=prod
```

### 🔧 Variables de Entorno (Producción)
```bash
# Base de datos
export DB_USERNAME=prod_user
export DB_PASSWORD=prod_password

# JWT
export JWT_SECRET=your-super-secret-jwt-key

# Email
export EMAIL_USERNAME=prod@company.com
export EMAIL_PASSWORD=email-app-password
```

</div>

</div>

---

<div style="background: #ffffff; padding: 25px; border-radius: 15px; margin: 30px 0; border: 2px solid #e9ecef; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">

## 🧪 Testing y Calidad

<div style="background: #f8f9fa; padding: 25px; border-radius: 10px; margin-top: 20px; border: 1px solid #dee2e6;">

### 🧪 Pruebas Unitarias
```bash
# Ejecutar todas las pruebas unitarias
mvn test

# Ejecutar pruebas con cobertura
mvn test jacoco:report
```

### 🔗 Pruebas de Integración
```bash
# Ejecutar pruebas de integración
mvn verify

# Ejecutar con TestContainers
mvn test -Dspring.profiles.active=test
```

### 📊 Pruebas de Rendimiento
```bash
# Ejecutar pruebas de carga con JMeter
jmeter -n -t performance-tests/load-test.jmx -l results.jtl
```

### 🛠️ Tecnologías de Testing
- **JUnit 5** - Pruebas unitarias
- **Spring Boot Test** - Pruebas de integración
- **TestContainers** - Pruebas con base de datos real
- **Mockito** - Mocking para pruebas

</div>

</div>

---

<div style="background: #ffffff; padding: 25px; border-radius: 15px; margin: 30px 0; border: 2px solid #e9ecef; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">

## 🚀 Despliegue

<div style="background: #f8f9fa; padding: 25px; border-radius: 10px; margin-top: 20px; border: 1px solid #dee2e6;">

<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">

### 🐳 Docker
```bash
# Construir imagen
docker build -t users-service .

# Ejecutar contenedor
docker run -p 8082:8082 users-service
```

### 🐙 Docker Compose
```yaml
version: '3.8'
services:
  users-service:
    build: .
    ports:
      - "8082:8082"
    environment:
      - SPRING_PROFILES_ACTIVE=docker
    depends_on:
      - mariadb
      - eureka-server
```

### ☸️ Kubernetes
```bash
# Aplicar configuración
kubectl apply -f k8s/

# Verificar estado
kubectl get pods -l app=users-service
```

### 🔄 CI/CD
```yaml
name: CI/CD Pipeline
on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Run Tests
        run: mvn test
      - name: Build
        run: mvn package
```

</div>

</div>

</div>

---

<div style="background: #ffffff; padding: 25px; border-radius: 15px; margin: 30px 0; border: 2px solid #e9ecef; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">

## 📚 Documentación y Recursos

<div style="background: #f8f9fa; padding: 25px; border-radius: 10px; margin-top: 20px; border: 1px solid #dee2e6;">

### 📖 Swagger UI
- **URL**: `http://localhost:8082/swagger-ui.html`
- **OpenAPI JSON**: `http://localhost:8082/api-docs`

### 📊 Monitoreo
- **Health Check**: `GET /actuator/health`
- **Métricas Prometheus**: `GET /actuator/prometheus`
- **Info de la Aplicación**: `GET /actuator/info`

### 📝 Logs
Los logs se guardan en `./logs/` con rotación automática:
- Archivo actual: `users-service.log`
- Archivos rotados: `archived/users-service-YYYY-MM-DD.N.log`

### 🔧 Comandos Útiles
```bash
# Ver tamaño de logs
du -sh logs/

# Ver logs en tiempo real
tail -f logs/users-service.log

# Limpiar logs
chmod +x users/clean-logs.sh
```

</div>

</div>

---

<div style="background: #ffffff; padding: 25px; border-radius: 15px; margin: 30px 0; border: 2px solid #e9ecef; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">

## 🤝 Contribución

<div style="background: #f8f9fa; padding: 25px; border-radius: 10px; margin-top: 20px; border: 1px solid #dee2e6;">

### 📋 Guías de Contribución
1. **Fork** el proyecto
2. Crear una rama para tu feature (`git checkout -b feature/AmazingFeature`)
3. **Commit** tus cambios (`git commit -m 'Add some AmazingFeature'`)
4. **Push** a la rama (`git push origin feature/AmazingFeature`)
5. Abrir un **Pull Request**

### ✅ Estándares de Código
- Seguir las convenciones de código
- Incluir pruebas para nuevas funcionalidades
- Actualizar documentación según sea necesario
- Verificar que todas las pruebas pasen

</div>

</div>

---

<div style="background: #ffffff; padding: 25px; border-radius: 15px; margin: 30px 0; border: 2px solid #e9ecef; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">

## 📞 Soporte y Contacto

<div style="background: #f8f9fa; padding: 25px; border-radius: 10px; margin-top: 20px; border: 1px solid #dee2e6;">

<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">

### 📧 Contacto
- **Email**: soporte@empresa.com
- **Documentación**: [docs.empresa.com](https://docs.empresa.com)
- **Issues**: [GitHub Issues](https://github.com/empresa/users-service/issues)

### 📄 Licencia
Este proyecto está bajo la **Licencia Apache 2.0** - ver el archivo [LICENSE](LICENSE) para más detalles.

### ⭐ Estrellas
Si este proyecto te ha sido útil, ¡considera darle una estrella! ⭐

</div>

</div>

</div>

---

<div align="center" style="margin-top: 50px; padding: 20px; background: #f8f9fa; border-radius: 15px; color: #212529; border: 2px solid #e9ecef; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">

### 🎉 ¡Gracias por usar nuestro Microservicio de Gestión de Usuarios!

<div style="margin-top: 15px; font-size: 0.9em; color: #6c757d;">
Desarrollado con ❤️ usando Spring Boot y Arquitectura Hexagonal
</div>

</div>
</div> 